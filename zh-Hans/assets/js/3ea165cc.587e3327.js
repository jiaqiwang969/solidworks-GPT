"use strict";(self.webpackChunksolidworks_gpt=self.webpackChunksolidworks_gpt||[]).push([[65267],{3905:(e,t,o)=>{o.d(t,{Zo:()=>c,kt:()=>y});var r=o(67294);function n(e,t,o){return t in e?Object.defineProperty(e,t,{value:o,enumerable:!0,configurable:!0,writable:!0}):e[t]=o,e}function s(e,t){var o=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),o.push.apply(o,r)}return o}function a(e){for(var t=1;t<arguments.length;t++){var o=null!=arguments[t]?arguments[t]:{};t%2?s(Object(o),!0).forEach((function(t){n(e,t,o[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(o)):s(Object(o)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(o,t))}))}return e}function i(e,t){if(null==e)return{};var o,r,n=function(e,t){if(null==e)return{};var o,r,n={},s=Object.keys(e);for(r=0;r<s.length;r++)o=s[r],t.indexOf(o)>=0||(n[o]=e[o]);return n}(e,t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);for(r=0;r<s.length;r++)o=s[r],t.indexOf(o)>=0||Object.prototype.propertyIsEnumerable.call(e,o)&&(n[o]=e[o])}return n}var d=r.createContext({}),l=function(e){var t=r.useContext(d),o=t;return e&&(o="function"==typeof e?e(t):a(a({},t),e)),o},c=function(e){var t=l(e.components);return r.createElement(d.Provider,{value:t},e.children)},m="mdxType",p={inlineCode:"code",wrapper:function(e){var t=e.children;return r.createElement(r.Fragment,{},t)}},u=r.forwardRef((function(e,t){var o=e.components,n=e.mdxType,s=e.originalType,d=e.parentName,c=i(e,["components","mdxType","originalType","parentName"]),m=l(o),u=n,y=m["".concat(d,".").concat(u)]||m[u]||p[u]||s;return o?r.createElement(y,a(a({ref:t},c),{},{components:o})):r.createElement(y,a({ref:t},c))}));function y(e,t){var o=arguments,n=t&&t.mdxType;if("string"==typeof e||n){var s=o.length,a=new Array(s);a[0]=u;var i={};for(var d in t)hasOwnProperty.call(t,d)&&(i[d]=t[d]);i.originalType=e,i[m]="string"==typeof e?e:n,a[1]=i;for(var l=2;l<s;l++)a[l]=o[l];return r.createElement.apply(null,a)}return r.createElement.apply(null,o)}u.displayName="MDXCreateElement"},85656:(e,t,o)=>{o.r(t),o.d(t,{assets:()=>d,contentTitle:()=>a,default:()=>p,frontMatter:()=>s,metadata:()=>i,toc:()=>l});var r=o(87462),n=(o(67294),o(3905));const s={title:"Storing and restoring temp body in 3rd party storage using SOLIDWORKS API",caption:"Store And Restore Body",description:"Storing the temp body in the SOLIDWORKS document stream via 3rd party storage and restoring it on opening using SOLIDWORKS API",image:"restored-body.png",labels:["3rd party storage","store body","restore body"]},a=void 0,i={unversionedId:"codestack-clone/solidworks-api/geometry/store-restore-body/index",id:"codestack-clone/solidworks-api/geometry/store-restore-body/index",title:"Storing and restoring temp body in 3rd party storage using SOLIDWORKS API",description:"Storing the temp body in the SOLIDWORKS document stream via 3rd party storage and restoring it on opening using SOLIDWORKS API",source:"@site/docs/codestack-clone/solidworks-api/geometry/store-restore-body/index.md",sourceDirName:"codestack-clone/solidworks-api/geometry/store-restore-body",slug:"/codestack-clone/solidworks-api/geometry/store-restore-body/",permalink:"/solidworks-GPT/zh-Hans/docs/codestack-clone/solidworks-api/geometry/store-restore-body/",draft:!1,editUrl:"https://github.com/jiaqiwang969/solidworks-GPT/edit/main/website/docs/codestack-clone/solidworks-api/geometry/store-restore-body/index.md",tags:[],version:"current",frontMatter:{title:"Storing and restoring temp body in 3rd party storage using SOLIDWORKS API",caption:"Store And Restore Body",description:"Storing the temp body in the SOLIDWORKS document stream via 3rd party storage and restoring it on opening using SOLIDWORKS API",image:"restored-body.png",labels:["3rd party storage","store body","restore body"]},sidebar:"tutorialSidebar",previous:{title:"SOLIDWORKS Macro to Split Body By Faces using SOLIDWORKS API",permalink:"/solidworks-GPT/zh-Hans/docs/codestack-clone/solidworks-api/geometry/split-body-by-faces/"},next:{title:"SOLIDWORKS macro finds intersection points between surface and curve",permalink:"/solidworks-GPT/zh-Hans/docs/codestack-clone/solidworks-api/geometry/surface-curve-intersection/"}},d={},l=[{value:"Running Macro",id:"running-macro",level:2}],c={toc:l},m="wrapper";function p(e){let{components:t,...s}=e;return(0,n.kt)(m,(0,r.Z)({},c,s,{components:t,mdxType:"MDXLayout"}),(0,n.kt)("p",null,"This VBA example demonstrates how to store the copy of the selected body in the new document's stream and restore and display the body on model opening."),(0,n.kt)("p",null,"Body is serialized and deserialized from the ",(0,n.kt)("a",{parentName:"p",href:"/docs/codestack/solidworks-api/data-storage/third-party/"},"3rd party storage"),"."),(0,n.kt)("ul",null,(0,n.kt)("li",{parentName:"ul"},"Create new macro and add new form. Name it ",(0,n.kt)("em",{parentName:"li"},"UserForm1")," (default name)"),(0,n.kt)("li",{parentName:"ul"},"Add the button. Specify the caption ",(0,n.kt)("em",{parentName:"li"},"Store Body")," and name ",(0,n.kt)("em",{parentName:"li"},"cmdStoreBody")," as shown below")),(0,n.kt)("p",null,(0,n.kt)("img",{alt:"Macro tree and user form controls",src:o(52362).Z,width:"742",height:"693"}),"{ width=450 }"),(0,n.kt)("ul",null,(0,n.kt)("li",{parentName:"ul"},"Paste the following into the user form's code behind:")),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-vb"},'Const BODY_STREAM_NAME = "_CodeStackBody_"\n\nDim WithEvents swApp As SldWorks.SldWorks\nDim swModeler As SldWorks.Modeler\nDim WithEvents swCurPart As SldWorks.PartDoc\nDim swCurBody As SldWorks.Body2\n\nPrivate Sub UserForm_Initialize()\n    \n    Set swApp = Application.SldWorks\n    Set swModeler = swApp.GetModeler\n    \nEnd Sub\n\nPrivate Function swApp_DocumentLoadNotify(ByVal docTitle As String, ByVal docPath As String) As Long\n    \n    If docPath <> "" Then\n    \n        Dim swModel As SldWorks.ModelDoc2\n        Set swModel = swApp.GetOpenDocumentByName(docPath)\n        \n        If TypeOf swModel Is SldWorks.PartDoc Then\n            Set swCurPart = swModel\n        End If\n        \n    End If\n    \nEnd Function\n\nPrivate Function swCurPart_LoadFromStorageNotify() As Long\n    DisplayBodyFromStream\n    swCurPart_LoadFromStorageNotify = 0\nEnd Function\n\nPrivate Function swCurPart_SaveToStorageNotify() As Long\n\n    If Not swCurBody Is Nothing Then\n        StoreBodyToStream\n        MsgBox "Body is stored to the model stream. Close and reopen the model to restore the body"\n    End If\n    \n    swCurPart_SaveToStorageNotify = 0\n    \nEnd Function\n\nPrivate Sub cmdStoreBody_Click()\n    \n    Dim swModel As SldWorks.ModelDoc2\n    Set swModel = swApp.ActiveDoc\n    \n    Dim swSelMgr As SldWorks.SelectionMgr\n    Set swSelMgr = swModel.SelectionManager\n    \n    Set swCurBody = swSelMgr.GetSelectedObject6(1, -1)\n    \n    If Not swCurBody Is Nothing Then\n        Set swCurBody = swCurBody.Copy\n        Dim partTemplate As String\n        partTemplate = swApp.GetUserPreferenceStringValue(swUserPreferenceStringValue_e.swDefaultTemplatePart)\n        Set swCurPart = swApp.NewDocument(partTemplate, swDwgPaperSizes_e.swDwgPapersUserDefined, 0, 0)\n        MsgBox "Save this document to store the body in its stream"\n    Else\n        MsgBox "Please select body"\n    End If\n    \nEnd Sub\n\nSub DisplayBodyFromStream()\n    \n    Dim swModel As SldWorks.ModelDoc2\n    Set swModel = swCurPart\n    \n    Dim swStream As Variant\n    Set swStream = swModel.IGet3rdPartyStorage(BODY_STREAM_NAME, False)\n    \n    If Not swStream Is Nothing Then\n        \n        Set swCurBody = swModeler.Restore(swStream)\n        swModel.IRelease3rdPartyStorage BODY_STREAM_NAME\n        swCurBody.Display3 swModel, RGB(255, 255, 0), swTempBodySelectOptions_e.swTempBodySelectable\n        \n    End If\n    \nEnd Sub\n\nSub StoreBodyToStream()\n    \n    Dim swModel As SldWorks.ModelDoc2\n    Set swModel = swCurPart\n    Dim swStream As Variant\n    Set swStream = swModel.IGet3rdPartyStorage(BODY_STREAM_NAME, True)\n    swCurBody.Save swStream\n    swModel.IRelease3rdPartyStorage BODY_STREAM_NAME\n    \nEnd Sub\n')),(0,n.kt)("ul",null,(0,n.kt)("li",{parentName:"ul"},"Insert the following code into the macro's main module:")),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-vb"},"Sub main()\n\n    UserForm1.Show vbModeless\n    \nEnd Sub\n")),(0,n.kt)("h2",{id:"running-macro"},"Running Macro"),(0,n.kt)("ul",null,(0,n.kt)("li",{parentName:"ul"},"Start the macro from the main module. Note, if you run the macro when form is active in the macro editor - form will be displayed as modal window and will prevent selections and saving"),(0,n.kt)("li",{parentName:"ul"},"Open any part document with any geometry"),(0,n.kt)("li",{parentName:"ul"},"Select solid body from the tree and click ",(0,n.kt)("em",{parentName:"li"},"Store Body")," in the user form"),(0,n.kt)("li",{parentName:"ul"},"New part document is created and the following message is displayed: ",(0,n.kt)("em",{parentName:"li"},"Save this document to store the body in its stream")),(0,n.kt)("li",{parentName:"ul"},"Save this file. When file is saving the body from different part is serialized into the stream of new document and no longer related to the original body."),(0,n.kt)("li",{parentName:"ul"},"Once completed, the following message is displayed: ",(0,n.kt)("em",{parentName:"li"},"Body is stored to the model stream. Close and reopen the model to restore the body")),(0,n.kt)("li",{parentName:"ul"},"Now, close all documents and reopen the last saved file. The body is deserialized and displayed. Note, that there is no feature tree in the model.")),(0,n.kt)("p",null,(0,n.kt)("img",{alt:"Restored body",src:o(69328).Z,width:"706",height:"402"}),"{ width=350 }"),(0,n.kt)("ul",null,(0,n.kt)("li",{parentName:"ul"},"You can close SOLIDWORKS session and reopen the model. The body will still be loaded. Note, you need to run the macro before opening the model.")))}p.isMDXComponent=!0},52362:(e,t,o)=>{o.d(t,{Z:()=>r});const r=o.p+"assets/images/macro-solution-tree-6f4721672c33e58ee94566bf00466d13.png"},69328:(e,t,o)=>{o.d(t,{Z:()=>r});const r=o.p+"assets/images/restored-body-f03ad2171d9e10b820856bf96b5605ab.png"}}]);