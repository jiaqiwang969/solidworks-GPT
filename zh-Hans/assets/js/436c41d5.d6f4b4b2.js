"use strict";(self.webpackChunksolidworks_gpt=self.webpackChunksolidworks_gpt||[]).push([[93649],{3905:(e,t,o)=>{o.d(t,{Zo:()=>c,kt:()=>w});var r=o(67294);function n(e,t,o){return t in e?Object.defineProperty(e,t,{value:o,enumerable:!0,configurable:!0,writable:!0}):e[t]=o,e}function a(e,t){var o=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),o.push.apply(o,r)}return o}function s(e){for(var t=1;t<arguments.length;t++){var o=null!=arguments[t]?arguments[t]:{};t%2?a(Object(o),!0).forEach((function(t){n(e,t,o[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(o)):a(Object(o)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(o,t))}))}return e}function i(e,t){if(null==e)return{};var o,r,n=function(e,t){if(null==e)return{};var o,r,n={},a=Object.keys(e);for(r=0;r<a.length;r++)o=a[r],t.indexOf(o)>=0||(n[o]=e[o]);return n}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(r=0;r<a.length;r++)o=a[r],t.indexOf(o)>=0||Object.prototype.propertyIsEnumerable.call(e,o)&&(n[o]=e[o])}return n}var d=r.createContext({}),l=function(e){var t=r.useContext(d),o=t;return e&&(o="function"==typeof e?e(t):s(s({},t),e)),o},c=function(e){var t=l(e.components);return r.createElement(d.Provider,{value:t},e.children)},m="mdxType",p={inlineCode:"code",wrapper:function(e){var t=e.children;return r.createElement(r.Fragment,{},t)}},u=r.forwardRef((function(e,t){var o=e.components,n=e.mdxType,a=e.originalType,d=e.parentName,c=i(e,["components","mdxType","originalType","parentName"]),m=l(o),u=n,w=m["".concat(d,".").concat(u)]||m[u]||p[u]||a;return o?r.createElement(w,s(s({ref:t},c),{},{components:o})):r.createElement(w,s({ref:t},c))}));function w(e,t){var o=arguments,n=t&&t.mdxType;if("string"==typeof e||n){var a=o.length,s=new Array(a);s[0]=u;var i={};for(var d in t)hasOwnProperty.call(t,d)&&(i[d]=t[d]);i.originalType=e,i[m]="string"==typeof e?e:n,s[1]=i;for(var l=2;l<a;l++)s[l]=o[l];return r.createElement.apply(null,s)}return r.createElement.apply(null,o)}u.displayName="MDXCreateElement"},4821:(e,t,o)=>{o.r(t),o.d(t,{assets:()=>d,contentTitle:()=>s,default:()=>p,frontMatter:()=>a,metadata:()=>i,toc:()=>l});var r=o(87462),n=(o(67294),o(3905));const a={title:"Store and Restore Bodies to Third-Party Storage using SOLIDWORKS API",image:"restored-body.png",labels:["third-party storage","store bodies","restore bodies"]},s=void 0,i={unversionedId:"codestack/solidworks-api/geometry/store-restore-body/index",id:"codestack/solidworks-api/geometry/store-restore-body/index",title:"Store and Restore Bodies to Third-Party Storage using SOLIDWORKS API",description:"This VBA example demonstrates how to store copies of selected bodies in the stream of a new document and restore and display the bodies when the model is opened.",source:"@site/i18n/zh-Hans/docusaurus-plugin-content-docs/current/codestack/solidworks-api/geometry/store-restore-body/index.md",sourceDirName:"codestack/solidworks-api/geometry/store-restore-body",slug:"/codestack/solidworks-api/geometry/store-restore-body/",permalink:"/solidworks-GPT/zh-Hans/docs/codestack/solidworks-api/geometry/store-restore-body/",draft:!1,editUrl:"https://github.com/jiaqiwang969/solidworks-GPT/edit/main/website/docs/codestack/solidworks-api/geometry/store-restore-body/index.md",tags:[],version:"current",frontMatter:{title:"Store and Restore Bodies to Third-Party Storage using SOLIDWORKS API",image:"restored-body.png",labels:["third-party storage","store bodies","restore bodies"]},sidebar:"tutorialSidebar",previous:{title:"\u4f7f\u7528SOLIDWORKS API\u62c6\u5206\u9762\u7684SOLIDWORKS\u5b8f",permalink:"/solidworks-GPT/zh-Hans/docs/codestack/solidworks-api/geometry/split-body-by-faces/"},next:{title:"SOLIDWORKS\u5b8f\u67e5\u627e\u66f2\u9762\u548c\u66f2\u7ebf\u4e4b\u95f4\u7684\u4ea4\u70b9",permalink:"/solidworks-GPT/zh-Hans/docs/codestack/solidworks-api/geometry/surface-curve-intersection/"}},d={},l=[{value:"Run the Macro",id:"run-the-macro",level:2}],c={toc:l},m="wrapper";function p(e){let{components:t,...a}=e;return(0,n.kt)(m,(0,r.Z)({},c,a,{components:t,mdxType:"MDXLayout"}),(0,n.kt)("p",null,"This VBA example demonstrates how to store copies of selected bodies in the stream of a new document and restore and display the bodies when the model is opened."),(0,n.kt)("p",null,"The bodies are serialized and deserialized using ",(0,n.kt)("a",{parentName:"p",href:"/docs/codestack/solidworks-api/data-storage/third-party/"},"third-party storage"),"."),(0,n.kt)("ul",null,(0,n.kt)("li",{parentName:"ul"},"Create a new macro and add a new user form. Name it ",(0,n.kt)("em",{parentName:"li"},"UserForm1")," (default name)."),(0,n.kt)("li",{parentName:"ul"},"Add a button. Specify the caption as ",(0,n.kt)("em",{parentName:"li"},"Store Body")," and the name as ",(0,n.kt)("em",{parentName:"li"},"cmdStoreBody")," as shown below:")),(0,n.kt)("p",null,(0,n.kt)("img",{alt:"Macro tree and user form controls",src:o(62658).Z,width:"742",height:"693"}),"{ width=450 }"),(0,n.kt)("ul",null,(0,n.kt)("li",{parentName:"ul"},"Paste the following code after the code of the user form:")),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-vb"},'Const BODY_STREAM_NAME = "_CodeStackBody_"\n\nDim WithEvents swApp As SldWorks.SldWorks\nDim swModeler As SldWorks.Modeler\nDim WithEvents swCurPart As SldWorks.PartDoc\nDim swCurBody As SldWorks.Body2\n\nPrivate Sub UserForm_Initialize()\n    \n    Set swApp = Application.SldWorks\n    Set swModeler = swApp.GetModeler\n    \nEnd Sub\n\nPrivate Function swApp_DocumentLoadNotify(ByVal docTitle As String, ByVal docPath As String) As Long\n    \n    If docPath <> "" Then\n    \n        Dim swModel As SldWorks.ModelDoc2\n        Set swModel = swApp.GetOpenDocumentByName(docPath)\n        \n        If TypeOf swModel Is SldWorks.PartDoc Then\n            Set swCurPart = swModel\n        End If\n        \n    End If\n    \nEnd Function\n\nPrivate Function swCurPart_LoadFromStorageNotify() As Long\n    DisplayBodyFromStream\n    swCurPart_LoadFromStorageNotify = 0\nEnd Function\n\nPrivate Function swCurPart_SaveToStorageNotify() As Long\n\n    If Not swCurBody Is Nothing Then\n        StoreBodyToStream\n        MsgBox "Body is stored to the model stream. Close and reopen the model to restore the body"\n    End If\n    \n    swCurPart_SaveToStorageNotify = 0\n    \nEnd Function\n\nPrivate Sub cmdStoreBody_Click()\n    \n    Dim swModel As SldWorks.ModelDoc2\n    Set swModel = swApp.ActiveDoc\n    \n    Dim swSelMgr As SldWorks.SelectionMgr\n    Set swSelMgr = swModel.SelectionManager\n    \n    Set swCurBody = swSelMgr.GetSelectedObject6(1, -1)\n    \n    If Not swCurBody Is Nothing Then\n        Set swCurBody = swCurBody.Copy\n        Dim partTemplate As String\n        partTemplate = swApp.GetUserPreferenceStringValue(swUserPreferenceStringValue_e.swDefaultTemplatePart)\n        Set swCurPart = swApp.NewDocument(partTemplate, swDwgPaperSizes_e.swDwgPapersUserDefined, 0, 0)\n        MsgBox "Save this document to store the body in its stream"\n    Else\n        MsgBox "Please select body"\n    End If\n    \nEnd Sub\n\nSub DisplayBodyFromStream()\n    \n    Dim swModel As SldWorks.ModelDoc2\n    Set swModel = swCurPart\n    \n    Dim swStream As Variant\n    Set swStream = swModel.IGet3rdPartyStorage(BODY_STREAM_NAME, False)\n    \n    If Not swStream Is Nothing Then\n        \n        Set swCurBody = swModeler.Restore(swStream)\n        swModel.IRelease3rdPartyStorage BODY_STREAM_NAME\n        swCurBody.Display3 swModel, RGB(255, 255, 0), swTempBodySelectOptions_e.swTempBodySelectable\n        \n    End If\n    \nEnd Sub\n\nSub StoreBodyToStream()\n    \n    Dim swModel As SldWorks.ModelDoc2\n    Set swModel = swCurPart\n    Dim swStream As Variant\n    Set swStream = swModel.IGet3rdPartyStorage(BODY_STREAM_NAME, True)\n    swCurBody.Save swStream\n    swModel.IRelease3rdPartyStorage BODY_STREAM_NAME\n    \nEnd Sub\n')),(0,n.kt)("ul",null,(0,n.kt)("li",{parentName:"ul"},"Insert the following code into the main module of the macro:")),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-vb"},"Sub main()\n\n    UserForm1.Show vbModeless\n    \nEnd Sub\n")),(0,n.kt)("h2",{id:"run-the-macro"},"Run the Macro"),(0,n.kt)("ul",null,(0,n.kt)("li",{parentName:"ul"},"Start the macro from the main module. Note that if you run the macro with the form activated in the macro editor, the form will appear as a modal window and prevent selection and saving."),(0,n.kt)("li",{parentName:"ul"},"Open any part document with some bodies."),(0,n.kt)("li",{parentName:"ul"},"Select a body from the tree and click ",(0,n.kt)("em",{parentName:"li"},"Store Body")," in the user form."),(0,n.kt)("li",{parentName:"ul"},"Create a new part document and display the following message: ",(0,n.kt)("em",{parentName:"li"},"Save this document to store the body in its stream"),"."),(0,n.kt)("li",{parentName:"ul"},"Save this file. When the file is saved, the bodies from different parts are serialized into the stream of the new document and are no longer associated with the original bodies."),(0,n.kt)("li",{parentName:"ul"},"When finished, display the following message: ",(0,n.kt)("em",{parentName:"li"},"Body is stored to the model stream. Close and reopen the model to restore the body"),"."),(0,n.kt)("li",{parentName:"ul"},"Now, close all documents and reopen the last saved file. The bodies are deserialized and displayed. Note that there is no feature tree in the model.")),(0,n.kt)("p",null,(0,n.kt)("img",{alt:"Restored body",src:o(65800).Z,width:"706",height:"402"}),"{ width=350 }"),(0,n.kt)("ul",null,(0,n.kt)("li",{parentName:"ul"},"You can close the SOLIDWORKS session and reopen the model. The bodies will still be loaded. Note that you need to run the macro before opening the model.")))}p.isMDXComponent=!0},62658:(e,t,o)=>{o.d(t,{Z:()=>r});const r=o.p+"assets/images/macro-solution-tree-6f4721672c33e58ee94566bf00466d13.png"},65800:(e,t,o)=>{o.d(t,{Z:()=>r});const r=o.p+"assets/images/restored-body-f03ad2171d9e10b820856bf96b5605ab.png"}}]);