"use strict";(self.webpackChunksolidworks_gpt=self.webpackChunksolidworks_gpt||[]).push([[64742],{3905:(e,n,t)=>{t.d(n,{Zo:()=>d,kt:()=>b});var r=t(67294);function o(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function s(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n&&(r=r.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,r)}return t}function i(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?s(Object(t),!0).forEach((function(n){o(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):s(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function a(e,n){if(null==e)return{};var t,r,o=function(e,n){if(null==e)return{};var t,r,o={},s=Object.keys(e);for(r=0;r<s.length;r++)t=s[r],n.indexOf(t)>=0||(o[t]=e[t]);return o}(e,n);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);for(r=0;r<s.length;r++)t=s[r],n.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(o[t]=e[t])}return o}var l=r.createContext({}),m=function(e){var n=r.useContext(l),t=n;return e&&(t="function"==typeof e?e(n):i(i({},n),e)),t},d=function(e){var n=m(e.components);return r.createElement(l.Provider,{value:n},e.children)},c="mdxType",u={inlineCode:"code",wrapper:function(e){var n=e.children;return r.createElement(r.Fragment,{},n)}},f=r.forwardRef((function(e,n){var t=e.components,o=e.mdxType,s=e.originalType,l=e.parentName,d=a(e,["components","mdxType","originalType","parentName"]),c=m(t),f=o,b=c["".concat(l,".").concat(f)]||c[f]||u[f]||s;return t?r.createElement(b,i(i({ref:n},d),{},{components:t})):r.createElement(b,i({ref:n},d))}));function b(e,n){var t=arguments,o=n&&n.mdxType;if("string"==typeof e||o){var s=t.length,i=new Array(s);i[0]=f;var a={};for(var l in n)hasOwnProperty.call(n,l)&&(a[l]=n[l]);a.originalType=e,a[c]="string"==typeof e?e:o,i[1]=a;for(var m=2;m<s;m++)i[m]=t[m];return r.createElement.apply(null,i)}return r.createElement.apply(null,t)}f.displayName="MDXCreateElement"},50381:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>l,contentTitle:()=>i,default:()=>u,frontMatter:()=>s,metadata:()=>a,toc:()=>m});var r=t(87462),o=(t(67294),t(3905));const s={title:"\u4f7f\u7528SOLIDWORKS API\u5c06\u9009\u5b9a\u7684\u5b9e\u4f53\u4fdd\u5b58\u5230\u5916\u90e8\u6587\u4ef6",caption:"\u4fdd\u5b58\u5b9e\u4f53\u5230\u6587\u4ef6"},i=void 0,a={unversionedId:"codestack/solidworks-api/geometry/save-body-to-file/index",id:"codestack/solidworks-api/geometry/save-body-to-file/index",title:"\u4f7f\u7528SOLIDWORKS API\u5c06\u9009\u5b9a\u7684\u5b9e\u4f53\u4fdd\u5b58\u5230\u5916\u90e8\u6587\u4ef6",description:"\u4f7f\u7528SOLIDWORKS API\u5c06\u9009\u5b9a\u7684\u5b9e\u4f53\uff08\u66f2\u9762\u6216\u5b9e\u4f53\uff09\u5e8f\u5217\u5316\u4e3aCOM\u6d41\uff0c\u5e76\u5c06\u5176\u5b58\u50a8\u5728\u5916\u90e8\u4e8c\u8fdb\u5236\u6587\u4ef6\u4e2d\u7684VBA\u793a\u4f8b",source:"@site/i18n/zh-Hans/docusaurus-plugin-content-docs/current/codestack/solidworks-api/geometry/save-body-to-file/index.md",sourceDirName:"codestack/solidworks-api/geometry/save-body-to-file",slug:"/codestack/solidworks-api/geometry/save-body-to-file/",permalink:"/solidworks-GPT/zh-Hans/docs/codestack/solidworks-api/geometry/save-body-to-file/",draft:!1,editUrl:"https://github.com/jiaqiwang969/solidworks-GPT/edit/main/website/docs/codestack/solidworks-api/geometry/save-body-to-file/index.md",tags:[],version:"current",frontMatter:{title:"\u4f7f\u7528SOLIDWORKS API\u5c06\u9009\u5b9a\u7684\u5b9e\u4f53\u4fdd\u5b58\u5230\u5916\u90e8\u6587\u4ef6",caption:"\u4fdd\u5b58\u5b9e\u4f53\u5230\u6587\u4ef6"},sidebar:"tutorialSidebar",previous:{title:"\u4f7f\u7528 SOLIDWORKS \u6a21\u578b API \u91cd\u5efa\u7403\u9762\u7684\u5b8f",permalink:"/solidworks-GPT/zh-Hans/docs/codestack/solidworks-api/geometry/reconstruct-spherical-surface/"},next:{title:"\u4f7f\u7528SOLIDWORKS API\u5728\u9009\u5b9a\u8fb9\u4e0a\u521b\u5efa\u8349\u56fe\u70b9",permalink:"/solidworks-GPT/zh-Hans/docs/codestack/solidworks-api/geometry/selected-edge-create-sketch-points/"}},l={},m=[{value:"labels: \u5e8f\u5217\u5316, COM\u6d41, \u4fdd\u5b58\u5b9e\u4f53",id:"labels-\u5e8f\u5217\u5316-com\u6d41-\u4fdd\u5b58\u5b9e\u4f53",level:2}],d={toc:m},c="wrapper";function u(e){let{components:n,...t}=e;return(0,o.kt)(c,(0,r.Z)({},d,t,{components:n,mdxType:"MDXLayout"}),(0,o.kt)("p",null,"\u4f7f\u7528SOLIDWORKS API\u5c06\u9009\u5b9a\u7684\u5b9e\u4f53\uff08\u66f2\u9762\u6216\u5b9e\u4f53\uff09\u5e8f\u5217\u5316\u4e3aCOM\u6d41\uff0c\u5e76\u5c06\u5176\u5b58\u50a8\u5728\u5916\u90e8\u4e8c\u8fdb\u5236\u6587\u4ef6\u4e2d\u7684VBA\u793a\u4f8b"),(0,o.kt)("h2",{id:"labels-\u5e8f\u5217\u5316-com\u6d41-\u4fdd\u5b58\u5b9e\u4f53"},"labels: ","[\u5e8f\u5217\u5316, COM\u6d41, \u4fdd\u5b58\u5b9e\u4f53]"),(0,o.kt)("p",null,"\u8fd9\u4e2aVBA\u793a\u4f8b\u6f14\u793a\u4e86\u5982\u4f55\u4f7f\u7528SOLIDWORKS API\u5c06\u9009\u5b9a\u7684\u5b9e\u4f53\uff08\u66f2\u9762\u6216\u5b9e\u4f53\uff09\u5e8f\u5217\u5316\u4e3aCOM\u6d41\uff0c\u5e76\u5c06\u5176\u5b58\u50a8\u5728\u5916\u90e8\u4e8c\u8fdb\u5236\u6587\u4ef6\u4e2d\u3002"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-vb"},'Imports SolidWorks.Interop.sldworks\nImports System.IO\nImports System.Runtime.InteropServices\nImports System.Runtime.InteropServices.ComTypes\n\nModule Module1\n\n    Declare Function CreateStreamOnHGlobal Lib "ole32" (ByVal hGlobal As IntPtr, ByVal fDeleteOnRelease As Boolean, ByRef ppstm As IStream) As Long\n\n    Const FILE_PATH As String = "D:\\body.dat"\n\n    Sub Main()\n\n        Dim app As ISldWorks = CreateObject("SldWorks.Application")\n        app.Visible = True\n\n        Dim model As IModelDoc2\n        model = app.ActiveDoc\n\n        If Not model Is Nothing Then\n\n            Dim body As IBody2 = model.ISelectionManager.GetSelectedObject6(1, -1)\n\n            If Not body Is Nothing Then\n                SaveBodyToFile(body, FILE_PATH)\n            Else\n                Throw New Exception("\u8bf7\u5148\u9009\u62e9\u8981\u5bfc\u51fa\u7684\u5b9e\u4f53")\n            End If\n\n        Else\n            Throw New Exception("\u8bf7\u5148\u6253\u5f00\u6a21\u578b")\n        End If\n\n    End Sub\n\n    Sub SaveBodyToFile(body As IBody2, filePath As String)\n\n        Dim stream As IStream = Nothing\n\n        CreateStreamOnHGlobal(IntPtr.Zero, True, stream)\n        body.Save(stream)\n\n        Dim comStream = New ComStream(stream, False, False)\n\n        Using fileStream = File.Create(filePath)\n            comStream.Seek(0, SeekOrigin.Begin)\n            comStream.CopyTo(fileStream)\n        End Using\n\n    End Sub\n\nEnd Module\n\nPublic Class ComStream\n    Inherits Stream\n\n    Private ReadOnly m_ComStream As IStream\n    Private ReadOnly m_Commit As Boolean\n    Private m_IsWritable As Boolean\n\n    Public Sub New(ByRef comStream As IStream, writable As Boolean, Optional commit As Boolean = True)\n\n        If comStream Is Nothing Then\n            Throw New ArgumentNullException(NameOf(comStream))\n        End If\n\n        m_ComStream = comStream\n        m_IsWritable = writable\n        m_Commit = commit\n\n    End Sub\n\n    Public Overrides ReadOnly Property CanRead() As Boolean\n        Get\n            Return True\n        End Get\n    End Property\n\n    Public Overrides ReadOnly Property CanSeek() As Boolean\n        Get\n            Return True\n        End Get\n    End Property\n\n    Public Overrides ReadOnly Property CanWrite() As Boolean\n        Get\n            Return m_IsWritable\n        End Get\n    End Property\n\n    Public Overrides ReadOnly Property Length As Long\n        Get\n            Const STATSFLAG_NONAME As Integer = 1\n\n            Dim stats As ComTypes.STATSTG = Nothing\n            m_ComStream.Stat(stats, STATSFLAG_NONAME)\n\n            Return stats.cbSize\n        End Get\n    End Property\n\n    Public Overrides Property Position() As Long\n        Get\n            Return Seek(0, SeekOrigin.Current)\n        End Get\n        Set(ByVal Value As Long)\n            Seek(Value, SeekOrigin.Begin)\n        End Set\n    End Property\n\n    Public Overrides Sub Flush()\n        If m_Commit Then\n            Const STGC_DEFAULT As Integer = 0\n            m_ComStream.Commit(STGC_DEFAULT)\n        End If\n    End Sub\n\n    Public Overrides Sub SetLength(ByVal Value As Long)\n        m_ComStream.SetSize(Value)\n    End Sub\n\n    Public Overrides Sub Write(buffer() As Byte, offset As Integer, count As Integer)\n        If offset <> 0 Then\n            Dim bufferSize As Integer\n            bufferSize = buffer.Length - offset\n            Dim tmpBuffer(bufferSize) As Byte\n            Array.Copy(buffer, offset, tmpBuffer, 0, bufferSize)\n            m_ComStream.Write(tmpBuffer, bufferSize, Nothing)\n        Else\n            m_ComStream.Write(buffer, count, Nothing)\n        End If\n    End Sub\n\n    Public Overrides Function Read(buffer() As Byte, offset As Integer, count As Integer) As Integer\n\n        Dim bytesRead As Integer = 0\n        Dim boxBytesRead As Object = bytesRead\n        Dim hObject As GCHandle\n\n        Try\n            hObject = GCHandle.Alloc(boxBytesRead, GCHandleType.Pinned)\n            Dim pBytesRead As IntPtr = hObject.AddrOfPinnedObject()\n\n            If offset <> 0 Then\n                Dim tmpBuffer(count - 1) As Byte\n                m_ComStream.Read(tmpBuffer, count, pBytesRead)\n                bytesRead = CInt(boxBytesRead)\n                Array.Copy(tmpBuffer, 0, buffer, offset, bytesRead)\n            Else\n                m_ComStream.Read(buffer, count, pBytesRead)\n                bytesRead = CInt(boxBytesRead)\n            End If\n\n        Finally\n            If hObject.IsAllocated Then\n                hObject.Free()\n            End If\n        End Try\n\n        Return bytesRead\n\n    End Function\n\n    Public Overrides Function Seek(offset As Long, origin As SeekOrigin) As Long\n\n        Dim curPosition As Long = 0\n        Dim boxCurPosition As Object = curPosition\n        Dim hObject As GCHandle\n\n        Try\n            hObject = GCHandle.Alloc(boxCurPosition, GCHandleType.Pinned)\n            Dim pCurPosition As IntPtr = hObject.AddrOfPinnedObject()\n\n            m_ComStream.Seek(offset, origin, pCurPosition)\n            curPosition = CLng(boxCurPosition)\n        Finally\n            If hObject.IsAllocated Then\n                hObject.Free()\n            End If\n        End Try\n\n        Return curPosition\n    End Function\n\n    Protected Overrides Sub Dispose(ByVal disposing As Boolean)\n        Try\n            If disposing Then\n                m_IsWritable = False\n            End If\n        Finally\n            MyBase.Dispose(disposing)\n        End Try\n    End Sub\n\n    Protected Overrides Sub Finalize()\n        Dispose(False)\n    End Sub\n\nEnd Class\n')),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-vba"},'Const FILE_PATH As String = "D:\\body.dat"\n\nPrivate Declare PtrSafe Function CreateStreamOnHGlobal Lib "ole32" (ByVal hGlobal As LongPtr, ByVal fDeleteOnRelease As Long, ByRef ppstm As Any) As Long\nPrivate Declare PtrSafe Function GlobalLock Lib "kernel32" (ByVal hMem As LongPtr) As Long\nPrivate Declare PtrSafe Function GlobalUnlock Lib "kernel32" (ByVal hMem As LongPtr) As Long\nPrivate Declare PtrSafe Function GlobalSize Lib "kernel32" (ByVal hMem As LongPtr) As Long\nPrivate Declare PtrSafe Function GetHGlobalFromStream Lib "ole32" (ByVal ppstm As LongPtr, hGlobal As LongPtr) As Long\nPrivate Declare PtrSafe Sub CopyMemory Lib "kernel32" Alias "RtlMoveMemory" (ByRef Destination As Any, ByRef Source As Any, ByVal Length As Long)\n    \nDim swApp As SldWorks.SldWorks\n\nSub main()\n\n    Set swApp = Application.SldWorks\n    \n    Dim swModel As SldWorks.ModelDoc2\n    Set swModel = swApp.ActiveDoc\n    \n    If Not swModel Is Nothing Then\n    \n        Dim swBody As SldWorks.Body2\n        Set swBody = swModel.SelectionManager.GetSelectedObject6(1, -1)\n        \n        If Not swBody Is Nothing Then\n            SaveBodyToFile swBody, FILE_PATH\n        Else\n            MsgBox "\u8bf7\u5148\u9009\u62e9\u8981\u5bfc\u51fa\u7684\u5b9e\u4f53"\n        End If\n    \n    Else\n        MsgBox "\u8bf7\u5148\u6253\u5f00\u6a21\u578b"\n    End If\n    \nEnd Sub\n\nSub SaveBodyToFile(body As SldWorks.Body2, filePath As String)\n    \n    Dim comStream As IUnknown\n            \n    If CreateStreamOnHGlobal(0, 0, comStream) Then\n        Err.Raise vbError, "", "\u65e0\u6cd5\u521b\u5efa\u65b0\u7684\u6d41"\n    End If\n    \n    body.Save comStream\n    \n    Dim buff() As Byte\n\n    buff = GetArrayFromComStream(comStream)\n    \n    WriteByteArrToFile filePath, buff\n    \nEnd Sub\n\nPrivate Function GetArrayFromComStream(comStream As IUnknown) As Byte()\n  \n    Dim buffer() As Byte\n  \n    Dim hMem As LongPtr\n    Dim lpMem As LongPtr\n    Dim bytesCount As Long\n     \n    If Not comStream Is Nothing Then\n     \n        If GetHGlobalFromStream(ByVal ObjPtr(comStream), hMem) = 0 Then\n            \n            bytesCount = GlobalSize(hMem)\n            \n            If bytesCount > 0 Then\n                \n                lpMem = GlobalLock(hMem)\n                \n                If lpMem <> 0 Then\n                    ReDim buffer(0 To bytesCount - 1)\n                    CopyMemory buffer(0), ByVal lpMem, bytesCount\n                    GlobalUnlock hMem\n                    GetArrayFromComStream = buffer\n                Else\n                    Err.Raise vbError, "", "\u65e0\u6cd5\u9501\u5b9a\u5185\u5b58"\n                End If\n            Else\n                Err.Raise vbError, "", "\u6d41\u4e3a\u7a7a"\n            End If\n        Else\n            Err.Raise vbError, "", "\u65e0\u6cd5\u4ece\u6d41\u4e2d\u83b7\u53d6\u53e5\u67c4"\n        End If\n    Else\n        Err.Raise vbError, "", "\u6d41\u4e3a\u7a7a"\n    End If\n     \nEnd Function\n\nFunction WriteByteArrToFile(filePath As String, buffer() As Byte)\n\n    Dim fileNmb As Integer\n    fileNmb = FreeFile\n    \n    Open filePath For Binary Access Write As #fileNmb\n    Put #fileNmb, 1, buffer\n    Close #fileNmb\n    \nEnd Function\n')))}u.isMDXComponent=!0}}]);